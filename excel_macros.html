<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlaeAutomates 2.0 - Excel Macros</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body>
    <!-- Mobile Block Message -->
    <div class="mobile-block">
        <div class="mobile-block-content">
            <svg class="icon" viewBox="0 0 24 24">
                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                <line x1="8" y1="21" x2="16" y2="21"></line>
                <line x1="12" y1="17" x2="12" y2="21"></line>
            </svg>
            <h1>Desktop Only</h1>
            <p>This application is designed for desktop use only. Please access it from a computer with a larger screen for the best experience.</p>
            <p style="color: var(--text-muted); font-size: 0.9rem;">Minimum screen width required: 768px</p>
        </div>
    </div>

    <!-- Modern Navigation Bar -->
    <nav class="modern-nav">
        <div class="nav-container">
            <div class="nav-brand" onclick="navigateTo('/')">
                <span class="brand-text">AlaeAutomates</span>
            </div>
            <div class="nav-right">
                <a href="https://alaeautomates.up.railway.app/" class="nav-item old-version" target="_blank">Old Version</a>
            </div>
        </div>
    </nav>

    <!-- Secondary Navigation -->
    <div class="secondary-nav">
        <div class="secondary-nav-container">
            <a href="monthly_statements.html" class="secondary-nav-item">Monthly Statements</a>
            <a href="invoices.html" class="secondary-nav-item">Invoice Processing</a>
            <a href="cc_batch.html" class="secondary-nav-item">CC Batch Processing</a>
            <a href="excel_macros.html" class="secondary-nav-item active">Excel Macros</a>
        </div>
    </div>

    <div class="feature-page-container">
        <!-- Background Animation -->
        <div class="feature-background-animation">
            <div class="feature-floating-element feature-element-1"></div>
            <div class="feature-floating-element feature-element-2"></div>
            <div class="feature-floating-element feature-element-3"></div>
            <div class="feature-floating-element feature-element-4"></div>
            
            <div class="feature-fire-dot feature-fire-dot-1"></div>
            <div class="feature-fire-dot feature-fire-dot-2"></div>
            <div class="feature-fire-dot feature-fire-dot-3"></div>
            <div class="feature-fire-dot feature-fire-dot-4"></div>
            <div class="feature-fire-dot feature-fire-dot-5"></div>
            <div class="feature-fire-dot feature-fire-dot-6"></div>
            
            <div class="feature-white-dot feature-white-dot-1"></div>
            <div class="feature-white-dot feature-white-dot-2"></div>
            <div class="feature-white-dot feature-white-dot-3"></div>
            <div class="feature-white-dot feature-white-dot-4"></div>
        </div>

        <div class="feature-content">
            <div class="feature-card">
                <div class="form-group-enhanced">
                    <label class="form-label-enhanced">
                        <svg class="icon" viewBox="0 0 24 24" style="display: inline; margin-right: 8px;">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14,2 14,8 20,8"></polyline>
                            <rect x="8" y="13" width="8" height="4" rx="1"></rect>
                            <path d="M10 15h4"></path>
                            <path d="M10 17h4"></path>
                        </svg>
                        Excel VBA Macros Collection
                    </label>
                    <p style="color: rgba(255,255,255,0.7); margin-bottom: 2rem;">Professional Excel macros for data processing and automation tasks.</p>
                </div>

                <div class="macros-grid">
                    <!-- Clean-up & Format Macro -->
                    <div class="macro-card">
                        <h3 class="macro-card-title">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14,2 14,8 20,8"></polyline>
                                <path d="M10 15h4"></path>
                                <path d="M10 17h2"></path>
                            </svg>
                            Clean-up & Format Macro
                        </h3>
                        <p class="macro-card-description">Removes empty rows and columns, trims whitespace from cells, applies consistent formatting, and auto-fits column widths.</p>
                        <button class="btn-enhanced btn-secondary-enhanced macro-card-button" onclick="showMacro('cleanupFormat')">
                            <svg class="icon" viewBox="0 0 24 24">
                                <polyline points="16 18 22 12 16 6"></polyline>
                                <polyline points="8 6 2 12 8 18"></polyline>
                            </svg>
                            View Code
                        </button>
                    </div>

                    <!-- Sort & Sum Macro -->
                    <div class="macro-card">
                        <h3 class="macro-card-title">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M3 6h18"></path>
                                <path d="M7 12h10"></path>
                                <path d="M10 18h4"></path>
                                <path d="M21 6l-3-3v6"></path>
                            </svg>
                            Sort & Sum Macro
                        </h3>
                        <p class="macro-card-description">Sorts data by specified column, adds sum totals for numeric columns, and preserves header formatting with professional styling.</p>
                        <button class="btn-enhanced btn-secondary-enhanced macro-card-button" onclick="showMacro('sortSum')">
                            <svg class="icon" viewBox="0 0 24 24">
                                <polyline points="16 18 22 12 16 6"></polyline>
                                <polyline points="8 6 2 12 8 18"></polyline>
                            </svg>
                            View Code
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Macro Display Modal -->
    <div class="modal-overlay" id="macroModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title" id="macroTitle">Excel Macro</h2>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 1rem;">
                    <button class="btn-enhanced btn-secondary-enhanced" id="copyMacroBtn">
                        <svg class="icon" viewBox="0 0 24 24">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                        Copy to Clipboard
                    </button>
                </div>
                <pre id="macroCode" style="background: #000; color: #00ff00; padding: 1.5rem; border-radius: 8px; overflow-x: auto; font-family: monospace; font-size: 0.9rem; line-height: 1.4; max-height: 60vh; overflow-y: auto; border: 1px solid rgba(255, 255, 255, 0.1);"></pre>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Global variables and functions
        let macroModal, modalClose, macroTitle, macroCode, copyMacroBtn;

        const macros = {
            cleanupFormat: {
                title: "Clean-up & Format Macro",
                code: `Sub CleanupAndFormat()
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim lastCol As Long
    Dim i As Long
    Dim j As Long
    
    Set ws = ActiveSheet
    
    ' Find the last row and column with data
    lastRow = ws.Cells(ws.Rows.Count, 1).End(xlUp).Row
    lastCol = ws.Cells(1, ws.Columns.Count).End(xlToLeft).Column
    
    Application.ScreenUpdating = False
    
    ' Remove empty rows
    For i = lastRow To 1 Step -1
        If Application.WorksheetFunction.CountA(ws.Rows(i)) = 0 Then
            ws.Rows(i).Delete
        End If
    Next i
    
    ' Remove empty columns
    For j = lastCol To 1 Step -1
        If Application.WorksheetFunction.CountA(ws.Columns(j)) = 0 Then
            ws.Columns(j).Delete
        End If
    Next j
    
    ' Recalculate ranges after deletion
    lastRow = ws.Cells(ws.Rows.Count, 1).End(xlUp).Row
    lastCol = ws.Cells(1, ws.Columns.Count).End(xlToLeft).Column
    
    ' Trim whitespace from all cells
    For i = 1 To lastRow
        For j = 1 To lastCol
            If Not IsEmpty(ws.Cells(i, j)) Then
                ws.Cells(i, j).Value = Trim(ws.Cells(i, j).Value)
            End If
        Next j
    Next i
    
    ' Auto-fit all columns
    ws.Columns.AutoFit
    
    ' Apply basic formatting
    With ws.Range(ws.Cells(1, 1), ws.Cells(lastRow, lastCol))
        .Font.Name = "Arial"
        .Font.Size = 10
        .Borders.LineStyle = xlContinuous
        .Borders.Weight = xlThin
    End With
    
    ' Format header row if it exists
    If lastRow > 0 Then
        With ws.Range(ws.Cells(1, 1), ws.Cells(1, lastCol))
            .Font.Bold = True
            .Interior.Color = RGB(220, 220, 220)
        End With
    End If
    
    Application.ScreenUpdating = True
    
    MsgBox "Cleanup and formatting completed!", vbInformation
End Sub`
            },
            sortSum: {
                title: "Sort & Sum Macro",
                code: `Sub SortAndSum()
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim lastCol As Long
    Dim dataRange As Range
    Dim response As Integer
    Dim sortCol As Integer
    
    Set ws = ActiveSheet
    
    ' Find the last row and column with data
    lastRow = ws.Cells(ws.Rows.Count, 1).End(xlUp).Row
    lastCol = ws.Cells(1, ws.Columns.Count).End(xlToLeft).Column
    
    If lastRow <= 1 Then
        MsgBox "No data to sort!", vbExclamation
        Exit Sub
    End If
    
    ' Ask user which column to sort by
    sortCol = InputBox("Enter column number to sort by (1 for A, 2 for B, etc.):", "Sort Column", 1)
    
    If sortCol < 1 Or sortCol > lastCol Then
        MsgBox "Invalid column number!", vbExclamation
        Exit Sub
    End If
    
    Set dataRange = ws.Range(ws.Cells(2, 1), ws.Cells(lastRow, lastCol))
    
    Application.ScreenUpdating = False
    
    ' Sort the data (excluding header row)
    dataRange.Sort Key1:=ws.Cells(2, sortCol), Order1:=xlAscending, Header:=xlNo
    
    ' Ask if user wants to add sum row
    response = MsgBox("Add sum row for numeric columns?", vbYesNo + vbQuestion, "Add Totals")
    
    If response = vbYes Then
        Dim i As Integer
        Dim sumRow As Long
        sumRow = lastRow + 2
        
        ' Add "Total:" label
        ws.Cells(sumRow, 1).Value = "Total:"
        ws.Cells(sumRow, 1).Font.Bold = True
        
        ' Add sums for numeric columns
        For i = 2 To lastCol
            If IsNumeric(ws.Cells(2, i).Value) Then
                ws.Cells(sumRow, i).Formula = "=SUM(" & ws.Range(ws.Cells(2, i), ws.Cells(lastRow, i)).Address & ")"
                ws.Cells(sumRow, i).Font.Bold = True
            End If
        Next i
        
        ' Format sum row
        With ws.Range(ws.Cells(sumRow, 1), ws.Cells(sumRow, lastCol))
            .Borders(xlEdgeTop).LineStyle = xlContinuous
            .Borders(xlEdgeTop).Weight = xlMedium
        End With
    End If
    
    ' Auto-fit columns
    ws.Columns.AutoFit
    
    Application.ScreenUpdating = True
    
    MsgBox "Sort and sum completed!", vbInformation
End Sub`
            }
        };

        function showMacro(macroKey) {
            console.log('showMacro called with key:', macroKey);
            console.log('Available macros:', Object.keys(macros));
            
            const macro = macros[macroKey];
            if (macro) {
                console.log('Macro found:', macro.title);
                macroTitle.textContent = macro.title;
                macroCode.textContent = macro.code;
                macroModal.classList.add('active');
                document.body.style.overflow = 'hidden';
            } else {
                console.error('Macro not found for key:', macroKey);
            }
        }

        function closeModal() {
            macroModal.classList.remove('active');
            document.body.style.overflow = '';
        }

        // Initialize DOM elements and event listeners when page loads
        document.addEventListener('DOMContentLoaded', function() {
            macroModal = document.getElementById('macroModal');
            modalClose = document.getElementById('modalClose');
            macroTitle = document.getElementById('macroTitle');
            macroCode = document.getElementById('macroCode');
            copyMacroBtn = document.getElementById('copyMacroBtn');

            modalClose.addEventListener('click', closeModal);
            macroModal.addEventListener('click', (e) => {
                if (e.target === macroModal) closeModal();
            });

            copyMacroBtn.addEventListener('click', async () => {
                try {
                    await navigator.clipboard.writeText(macroCode.textContent);
                    const originalText = copyMacroBtn.innerHTML;
                    copyMacroBtn.innerHTML = \`
                        <svg class="icon" viewBox="0 0 24 24">
                            <polyline points="20,6 9,17 4,12"></polyline>
                        </svg>
                        Copied!
                    \`;
                    setTimeout(() => {
                        copyMacroBtn.innerHTML = originalText;
                    }, 2000);
                } catch (err) {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = macroCode.textContent;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                }
            });
        });
    </script>
    
    <script>
        // Initialize Lucide icons
        lucide.createIcons();
    </script>
</body>
</html>